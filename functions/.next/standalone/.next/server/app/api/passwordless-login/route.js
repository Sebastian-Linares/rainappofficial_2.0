(()=>{var e={};e.id=622,e.ids=[622],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},363:(e,o,s)=>{"use strict";s.r(o),s.d(o,{patchFetch:()=>w,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>A});var r={};s.r(r),s.d(r,{OPTIONS:()=>u,POST:()=>c});var t=s(2706),n=s(8203),l=s(5994),a=s(9187);let i=require("firebase-admin");if(!i.apps.length)try{let e;let o=process.env.FIREBASE_ADMIN_SDK;if(!o)throw Error("FIREBASE_ADMIN_SDK environment variable is not set");try{e=JSON.parse(o)}catch(e){throw console.error("Failed to parse service account JSON:",e),Error("Invalid service account configuration")}i.initializeApp({credential:i.credential.cert(e),projectId:"rain-chat-official"}),console.log("Firebase Admin initialized successfully")}catch(e){throw console.error("Failed to initialize Firebase Admin:",e),e}async function c(e){console.log("Starting passwordless login request...");try{if(console.log("Request headers:",Object.fromEntries(e.headers)),!e.body)return console.log("No request body found"),a.NextResponse.json({error:"Request body is required"},{status:400,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}});let o=await e.json();console.log("Request body:",o);let{email:s}=o;if(console.log("Received login request for email:",s),!s)return console.log("Email is missing in request"),a.NextResponse.json({error:"Email is required"},{status:400,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}});try{console.log("Looking up user by email...");let e=await i.auth().getUserByEmail(s);console.log("User found:",e.uid),console.log("Creating custom token...");let o=await i.auth().createCustomToken(e.uid);console.log("Custom token created successfully");let r={token:o};return console.log("Sending success response:",r),a.NextResponse.json(r,{status:200,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}catch(o){if(console.error("Firebase Auth error:",o),"auth/user-not-found"===o.code)try{console.log("User not found, creating new user...");let e=await i.auth().createUser({email:s,emailVerified:!1});console.log("New user created:",e.uid);let o=await i.auth().createCustomToken(e.uid);console.log("Custom token created for new user");let r={token:o};return console.log("Sending success response for new user:",r),a.NextResponse.json(r,{status:200,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}catch(o){console.error("Failed to create new user:",o);let e={error:"Failed to create user account"};return console.log("Sending error response:",e),a.NextResponse.json(e,{status:500,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}let e={error:o.message||"Authentication failed"};return console.log("Sending auth error response:",e),a.NextResponse.json(e,{status:401,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}}catch(o){console.error("Error in passwordless login:",o);let e={error:"Internal server error"};return console.log("Sending internal error response:",e),a.NextResponse.json(e,{status:500,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}}async function u(e){return new a.NextResponse(null,{status:204,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type"}})}let d=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/passwordless-login/route",pathname:"/api/passwordless-login",filename:"route",bundlePath:"app/api/passwordless-login/route"},resolvedPagePath:"C:\\Users\\slina\\rainappofficial_2.0\\src\\app\\api\\passwordless-login\\route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:p,workUnitAsyncStorage:A,serverHooks:g}=d;function w(){return(0,l.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:A})}},6487:()=>{},8335:()=>{}};var o=require("../../../webpack-runtime.js");o.C(e);var s=e=>o(o.s=e),r=o.X(0,[638,452],()=>s(363));module.exports=r})();